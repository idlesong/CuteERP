<%= render 'shared/delivery_status_modal'%>

<!-- <p id="notice"><= notice ></p> -->
<h1><%=t(:sales_order)%></h1>

<div class="panel panel-default">
  <!-- <div class="panel-heading"><h3>Customer Order<h3></div> -->
  <div class="panel-body">

    <h2>
      <%=image_tag('sicomm_logo.jpg') %>无锡士康通讯技术有线公司
    </h2>
    <table class="table">
      <thead>
        <tr>
          <td>
            <h5>Wuxi Sicomm Communication Tech</h5>
            <h5>Address: B building #21 road, Wuxi </h5>
            <h5>Tel:051066682208 Fax: 051066682208</h5>
          </td>
          <td>
            <h4 class="text-right"><%=t(:show_date)%>:<%= @sales_order.created_at.to_date %></h4>
            <h4 class="text-right"><%=t(:sales_order_number)%>#:<%= @sales_order.serial_number %></h4>
            <h4 class="text-right"><%=t(:payment_term)%>:<%= @sales_order.payment_term %></h4>
            <h4 class="text-right">
              <% unless @sales_order.delivery_date.nil? %>
                <%=t(:ship_date)%>:<%= @sales_order.delivery_date.to_date %>
              <% else %>
                <%=t(:plan_ship_date)%>:
                <% if not @sales_order.delivery_plan.nil? %>
                  <%= @sales_order.delivery_plan.to_date %> 
                <% end %>
                <%= link_to(t(:ship_now), confirm_sales_order_path(@sales_order)) %>
              <% end %>
            </h4>
          </td>
        </tr>
      </thead>
      <tr><td colspan = "2"><h3 class="text-center"><%=t(:sales_order)%></h3></td></tr>
      <tr><td><h4><%=t(:bill_to)%>: <%= @sales_order.customer.name %></h4></td>
          <td><h4><%=t(:ship_to)%>: <%= @sales_order.customer.name %></h4></td></tr>

      </tr>
      <tr><td><strong><%=t(:contact)%>:</strong><%= @sales_order.bill_contact %></td>
          <td><strong><%=t(:contact)%>:</strong><%= @sales_order.ship_contact %></td></tr>
      <tr><td><strong><%=t(:address)%>:</strong><%= @sales_order.bill_address %></td>
          <td><strong><%=t(:address)%>:</strong><%= @sales_order.ship_address %></td></tr>
      <tr><td><strong><%=t(:telephone)%>:</strong><%= @sales_order.bill_telephone %></td>
          <td><strong><%=t(:telephone)%>:</strong><%= @sales_order.ship_telephone %></td></tr>
    </table>

  </div>
</div>

<div class="panel panel-default">
  <!-- <div class="panel-heading"><h5>Order Details<h5></div> -->
  <div class="panel-body">
    <h5><%=t(:order_details)%> </h5>
    <table class="table">
    	<thead>
    		<tr>
    			<th><h4>#</h4></th>
    			<th><h4><%=t(:product_name)%></h4></th>
    			<th><h4><%=t(:part_number)%></h4></th>
    			<th><h4><%=t(:quantity)%></h4></th>
    			<th><h4><%=t(:price)%></h4></th>
    			<th><h4><%=t(:suble_total)%></h4></th>
    			<th><h4><%=t(:remark)%></h4></th>
    		</tr>
    	</thead>
      <% if @sales_order.customer.currency == 'RMB'
            currency_unit = '¥'
          else
            currency_unit = '$'
          end %>
    	<% @sales_order.line_items.each do |line_item| %>
    		<tr>
    			<td>1 </td>
    			<td><%= line_item.full_name %> </td>
    			<td><%= line_item.full_part_number%> </td>
    			<td><%= line_item.quantity %> </td>
    			<% line_price = line_item.show_currency_price(@sales_order.exchange_rate, @sales_order.customer.currency) %>
    			<td>
            <% if currency_unit == '$' %>
              <a data-toggle="tooltip" data-placement="top" title=<%= "=(#{line_item.fixed_price})/1.17/#{@sales_order.exchange_rate}" %>>
      					<%= number_to_currency(line_price, unit: currency_unit) %>	</a>
            <% else %>
              <%= number_to_currency(line_price, unit: currency_unit) %>
            <% end %>
          </td>
    	    <td><%= number_to_currency(line_item.total_currency_price(@sales_order.exchange_rate,
    								@sales_order.customer.currency), unit: currency_unit) %></td>
    			<td></td>
    		</tr>
    	<% end %>

	    <tr><td colspan="7"> <strong><%=t(:remark)%>:</strong>
         <% if currency_unit == '$' %>
           Exchange rate:<%= @sales_order.exchange_rate %>
         <% end %>
         </td></tr>
    </table>
  </div>

  <div class="panel-footer">
    <% if not @sales_order.delivery_date %>
      <%= link_to t('.edit', :default => t("helpers.links.edit")), edit_sales_order_path(@sales_order) %> |
    <% end %>
    <button type="button" class="btn btn-link btn-primary" data-toggle="modal"
      data-target=".bs-invoice-modal-lg"><%=t(:invoice)%></button> |
    <button type="button" class="btn btn-link btn-primary" data-toggle="modal"
      data-target=".bs-packing-modal-lg"><%=t(:packing_list)%></button> |
    <% if @sales_order.delivery_status %>
      <%= "ship:#{@sales_order.delivery_status}" %>
    <% else %>
      <a class="shipLink" href="" data-toggle="modal" data-target="#deliveryStatusModal"
      data-id=<%="#{@sales_order.id}" %> > <%=t(:ship_status)%> </a>
    <% end %>
  </div>
</div>


<%= render('packing_list') %>


<!-- Large modal Invoice-->
<div class="modal fade bs-invoice-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">

        <%= render('invoice') %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <a href= <%="#{invoice_sales_order_path(@sales_order)}.pdf"%> class="btn btn-primary" target="_blank">Print Invoice </a>
      </div>
    </div>
  </div>
</div>
