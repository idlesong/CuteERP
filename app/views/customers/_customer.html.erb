<p id="notice"><%= notice %></p>
<h4> 客户：<%= @customer.name %> 地址:<%= @customer.address %>
   电话：<%= @customer.telephone %> 联系窗口：<%= @customer.contact %>
   <%= link_to('wiki', post_path(@customer.name,:query => "url")) %>
  <%= link_to 'edit', edit_customer_path(@customer) %></h4>

<h3> Contacts
<button type="button" class="btn btn-mini btn-primary ajax-new" data= <%= @customer.id %> id="/contacts">new contact</button>
</h3>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Name</th>
      <th>Title</th>
      <th>Mobile</th>
      <th>Telephone</th>
      <th>Email</th>
      <th>Note</th>
    </tr>
  </thead>

  <% @contacts.each do |contact| %>
    <tr>
      <td><%= best_in_place contact, :name, :type => :input %></td>
      <td><%= best_in_place contact, :title, :type => :input %></td>
      <td><%= best_in_place contact, :mobile, :type => :input %></td>
      <td><%= best_in_place contact, :telephone, :type => :input %></td>
      <td><%= best_in_place contact, :email, :type => :input %></td>
      <td><%= best_in_place contact, :note, :type => :input %></td>
    </tr>
  <% end %>
</table>

<h3>Pries</h3>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Price id</th>
      <th>Item name</th>
      <th>part number</th>
      <th>price</th>
      <th>payment terms</th>
      <th>codition</th>
      <th>status</th>
    </tr>
  </thead>

  <% @prices.each do |price| %>
  <tr>
    <td><%= link_to price.id, price_path(price) %></td>
    <td><%= price.item.name %> </td>
    <td><%= price.item.partNo %></td>
    <td><%= price.item.price %></td>
    <td><%= price.payment_terms %></td>
    <td><%= price.condition %></td>
    <td>Aproved</td>
  </tr>
  <% end %>
</table>

<h3>Orders</h3>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>CustomerID</th>
      <th>Name</th>
      <th>Address</th>
      <th>Email</th>
      <th>Pay type</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <% @orders.each do |order| %>
    <tr>
      <td><%= order.customer_id %></td>
      <td><%= order.name %></td>
      <td><%= order.address %></td>
      <td><%= order.email %></td>
      <td><%= order.pay_type %></td>
      <td><%= link_to 'Show', order %></td>
      <td><%= link_to 'Edit', edit_order_path(order) %></td>
      <td><%= link_to 'Destroy', order, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </tr>
  <% end %>
</table>

<h3>Opportunities
<button type="button" class="btn btn-mini btn-primary ajax-new" data= <%= @customer.id %> id="/opportunities">new opportunity</button>
</h3>

<% @opportunities.each do |opportunity| %>
  <h4> Priority:<%= opportunity.priority %> Project type: <strong><%= opportunity.project_type %>
    </strong> solution:<strong><%= opportunity.solution %> </strong>Note:<%= opportunity.note %>
  </h4>
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Date </th>
        <th>-</th>
        <th>Status</th>
        <th>Issue</th>
        <th>Todo des</th>
        <th>Todo Status</th>
        <th>Assign</th>
      </tr>
    </thead>

    <% @oppostatuses.each do |oppostatus| %>
      <% if oppostatus.opportunity_id == opportunity.id %>
      <% keyman = @users.map{|user| [user.id, user.name]} %>
      <tr>
        <td><%= oppostatus.created_at.strftime("%Y/%m/%d") %></td>
        <td><%= best_in_place oppostatus, :status_mark, :type => :select, :collection => Oppostatus::STATUS_LABEL  %></td>
        <td><%= best_in_place oppostatus, :status, :type => :input %></td>
        <td><%= best_in_place oppostatus, :issue, :type => :input %></td>
        <td><%= best_in_place oppostatus, :todo_description, :type => :input %></td>
        <td><%= best_in_place oppostatus, :todo_status, :type => :input %></td>
        <td><%= best_in_place oppostatus, :user_id, :type => :select, :collection => keyman %></td>
      </tr>
      <% end %>
    <% end %>
    <tr>
      <td COLSPAN=6>
      <button type="button" class="btn btn-mini btn-primary ajax-new"
      data= <%= opportunity.id %> data-2= <%= session[:user_id] %>
      id="/oppostatuses">new oppostatus</button>
      </td>
    </tr>
  </table>
<% end %>

<br />
